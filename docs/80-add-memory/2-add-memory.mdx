# üëê Add memory to the RAG application

In many Q&A applications we want to allow the user to have a back-and-forth conversation with the LLM, meaning the application needs some sort of "memory" of past questions and answers, and some logic for incorporating those into its current thinking. In this section, you will retrieve chat message history from MongoDB and incorporate it in your RAG application.

Fill in any `<CODE_BLOCK_N>` placeholders and run the cells under the **Step 10: Add memory to the RAG application** section in the notebook to add memory to the RAG application.

The answers for code blocks in this section are as follows:

**CODE_BLOCK_25**

<details>
<summary>Answer</summary>
<div>
```python
history_collection.create_index("session_id")
```
</div>
</details>

**CODE_BLOCK_26**

<details>
<summary>Answer</summary>
<div>
```python
{
    "session_id": session_id,
    "role": role,
    "content": content,
    "timestamp": datetime.now(),
}
```
</div>
</details>

**CODE_BLOCK_27**

<details>
<summary>Answer</summary>
<div>
```python
history_collection.insert_one(message)
```
</div>
</details>

**CODE_BLOCK_28**

<details>
<summary>Answer</summary>
<div>
```python
history_collection.find({"session_id": session_id}).sort("timestamp", 1)
```
</div>
</details>

**CODE_BLOCK_29**

<details>
<summary>Answer</summary>
<div>
```python
{"role": msg["role"], "content": msg["content"]} for msg in cursor
```
</div>
</details>

**CODE_BLOCK_30**

<details>
<summary>Answer</summary>
<div>
```python
message_history = retrieve_session_history(session_id)
messages += message_history
```
</div>
</details>

**CODE_BLOCK_31**

<details>
<summary>Answer</summary>
<div>
```python
user_message = {"role": "user", "content": user_query}
messages.append(user_message)
```
</div>
</details>

**CODE_BLOCK_32**

<details>
<summary>Answer</summary>
<div>
```python
store_chat_message(session_id, "user", user_query)
store_chat_message(session_id, "assistant", answer)
```
</div>
</details>