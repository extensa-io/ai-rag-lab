# ðŸ¦¹ Combine pre-filtering with vector search

Pre-filtering is a technique to optimize vector search by only considering documents that match certain criteria during vector search.

In this section, you will learn how to combine filters with vector search. This mainly involves:

* Updating the vector search index to include the appropriate filter fields
* Updating the `$vectorSearch` stage in the aggregation pipeline definition to include the filters

## Filter for documents where the content type is `Video`

To do this, you will first need to modify the vector search index you created previously.

**Updated index definition**

<details>
<summary>Answer</summary>
<div>
```python
{
  "fields": [
    {
      "type": "vector",
      "path": "embedding",
      "numDimensions": 384,
      "similarity": "cosine"
    },
    {
      "type":"filter",
      "path":"metadata.contentType"
    }
  ]
}
```
</div>
</details>

Once you have updated the vector search index, fill in any `<CODE_BLOCK_N>` placeholders and run the cells under the **Filter for documents where the content type is Video** section in the notebook to see how the filter impacts the vector search results.

The answers for code blocks in this section are as follows:

**CODE_BLOCK_11**

<details>
<summary>Answer</summary>
<div>
```python
[
    {
        "$vectorSearch": {
            "index": "vector_index",
            "path": "embedding",
            "queryVector": query_embedding,
            "numCandidates": 150,
            "limit": 5,
            "filter": {"metadata.contentType": "Video"}
        }
    },
    {
        "$project": {
            "_id": 0,
            "body": 1,
            "score": {"$meta": "vectorSearchScore"}
        }
    }
]
```
</div>
</details>


## Filter on documents which have been updated on or after `2024-05-19` and where the content type is `Tutorial`

Again, you will first need to modify the vector search index.

**Updated index definition**

<details>
<summary>Answer</summary>
<div>
```python
{
  "fields": [
    {
      "type": "vector",
      "path": "embedding",
      "numDimensions": 384,
      "similarity": "cosine"
    },
    {
      "type":"filter",
      "path":"metadata.contentType"
    },
    {
      "type":"filter",
      "path":"updated"
    }
  ]
}
```
</div>
</details>

Once you have updated the vector search index, fill in any `<CODE_BLOCK_N>` placeholders and run the cells under the **Filter on documents which have been updated on or after 2024-05-19 and where the content type is Tutorial** section in the notebook to see how the filter impacts the vector search results.

The answers for code blocks in this section are as follows:

**CODE_BLOCK_12**

<details>
<summary>Answer</summary>
<div>
```python
[
    {
        "$vectorSearch": {
            "index": "vector_index",
            "path": "embedding",
            "queryVector": query_embedding,
            "numCandidates": 150,
            "limit": 5,
            "filter": {
                "metadata.contentType": "Tutorial",
                "updated": {"$gte": "2024-05-19"}
            }
        }
    },
    {
        "$project": {
            "_id": 0,
            "body": 1,
            "score": {"$meta": "vectorSearchScore"}
        }
    }
]
```
</div>
</details>